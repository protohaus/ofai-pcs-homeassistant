# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Text to speech
tts:
  - platform: google_translate

# Default includes from Home Assistant
group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

homeassistant:
  packages:
    common_device_tracker: !include common/device_tracker.yaml

recorder:
  db_url: !secret mariadb_url
  purge_keep_days: 7
  purge_interval: 1
  commit_interval: 30 
  
switch:
  - platform: momentary
    name: Camera Snapshots
    mode: on
    toggle_for: 1
      
input_boolean:
  prevent_deep_sleep:
    name: Prevent Deep Sleep
    icon: mdi:sleep-off
    
# Add sliders control to Home Assistant to set position, speed and velocity of the stepper motor
input_number:
  stepper_set_absolute_target:
    name: stepper.set_absolute_target
    initial: 0
    min: -150000
    max: 150000
    step: 1
    mode: slider
  stepper_set_step_width:
    name: stepper.set_step_width
    initial: 0
    min: 0
    max: 3000
    step: 1
    mode: slider
  stepper_set_speed:
    name: stepper.set_speed
    initial: 250
    min: 0
    max: 1000
    step: 1
    mode: slider
  stepper_set_acceleration:
    name: stepper.set_acceleration
    initial: 500
    min: 0
    max: 1000
    step: 1
    mode: slider
  stepper_set_deceleration:
    name: stepper.set_deceleration
    initial: 1000
    min: 0
    max: 1000
    step: 1
    mode: slider
  
# Do something when the slider changes
automation stepper_send_absolute_target:
  - alias: Send absolute target value to controller
    id: stepper_send_absolute_target 
    trigger:
      platform: state
      entity_id: input_number.stepper_set_absolute_target
    action:
      - service: esphome.pcs1_espcontroller1_stepper_set_absolute_target
        data_template:
          target: '{{ trigger.to_state.state | int }}'

# Do something when the slider changes
automation stepper_send_speed:
  - alias: Send speed value to controller
    id: stepper_send_speed
    trigger:
      platform: state
      entity_id: input_number.stepper_set_speed
    action:
      # Replace livingroom with the name you gave the ESP
      - service: esphome.pcs1_espcontroller1_stepper_set_speed
        data_template:
          speed: '{{ trigger.to_state.state | int }}'

# Do something when the slider changes
automation stepper_send_acceleration:
  - alias: Send acceleration value to controller
    id: stepper_send_acceleration
    trigger:
      platform: state
      entity_id: input_number.stepper_set_acceleration
    action:
      # Replace livingroom with the name you gave the ESP
      - service: esphome.pcs1_espcontroller1_stepper_set_acceleration
        data_template:
          acceleration: '{{ trigger.to_state.state | int }}'
          
# Do something when the slider changes
automation stepper_send_deceleration:
  - alias: Send deceleration value to controller
    id: stepper_send_deceleration
    trigger:
      platform: state
      entity_id: input_number.stepper_set_deceleration
    action:
      # Replace livingroom with the name you gave the ESP
      - service: esphome.pcs1_espcontroller1_stepper_set_deceleration
        data_template:
          deceleration: '{{ trigger.to_state.state | int }}'  
          
# Do something when the slider changes
automation stepper_send_step_width:
  - alias: Send step_width value to controller
    id: stepper_send_step_width
    trigger:
      platform: state
      entity_id: input_number.stepper_set_step_width
    action:
      # Replace livingroom with the name you gave the ESP
      - service: esphome.pcs1_espcontroller1_stepper_set_step_width
        data_template:
          step_width: '{{ trigger.to_state.state | int }}'  